# Exploit Development: Format String Vulnerability to Execute /bin/sh via System Call  (FORMAT_STRING_3 problem)

 # Overview

In this challenge, the goal is to exploit a format string vulnerability in a program to redirect control to the system function in the libc library, which will allow us to execute a command (/bin/sh) and spawn a shell. The key idea is to use the leaked address of a function (in this case, setvbuf) in the libc library, calculate the necessary offsets to find the address of system, and then perform a format string attack to overwrite a function pointer in the Global Offset Table (GOT) with the address of system. This would ultimately result in the program executing system("/bin/sh").

 # Problem Breakdown

1) Format String Vulnerability: The program is vulnerable to a format string attack. This vulnerability allows us to read and write arbitrary memory locations by crafting specific format string input.

2) Leaking Addresses: During the program's execution, we are able to leak the address of a function from the libc library (in this case, setvbuf). This leaked address gives us a valuable piece of information to begin our exploit, as it allows us to calculate the base address of libc.

3) Understanding Offsets: To proceed with the exploit, we need to understand two key offsets:

        1) Offset of setvbuf from libc: This is the difference between the leaked address of setvbuf and the base address of libc.
        2) Offset of system from libc: This is the fixed offset between the base address of libc and the location of the system function.
        3) Exploiting the GOT: By leveraging the format string vulnerability, we can overwrite an entry in the Global Offset Table (GOT), such as puts, with the address of the system function. This is possible because function pointers in the GOT 
                               can  be manipulated via the format string, allowing us to hijack the control flow of the program.

 4) Triggering system("/bin/sh"): Once the GOT entry is overwritten with the address of system, the next time the program calls puts, it will instead call system("/bin/sh"). This will give us an interactive shell, which is the final goal of the 
                                  exploit.

# Solution Approach

1) Leaking the setvbuf Address: First, we exploit the format string vulnerability to leak the address of setvbuf from the stack. This gives us a known memory location within libc.

2) Calculating the Base Address of libc: With the leaked address of setvbuf and the known offset to setvbuf within libc, we subtract the offset from the leaked address to determine the base address of libc.

3) Finding the Address of system: Using the base address of libc and the known offset to the system function, we add the offset to the base address of libc to find the address of system.

4) Creating the Payload: The payload is constructed to overwrite the GOT entry for puts with the address of system. This is done using the format string attack, where we craft a payload that forces the program to write the address of system into the GOT.

5) Triggering the Shell: Once the GOT entry is overwritten, the program will call system("/bin/sh") the next time it attempts to call puts. This will give us a shell and allow us to interact with the system.

 # Key Concepts

1) Format String Vulnerability: A common vulnerability in C/C++ programs where user input is not properly sanitized, allowing an attacker to manipulate memory and control the program's execution.
2) GOT (Global Offset Table): A table used by the program to store the addresses of functions, allowing dynamic linking at runtime. It can be exploited to hijack function calls.
3) Libc: The standard C library, which contains essential functions like printf, system, and others. The addresses of functions in libc can be used to control the flow of execution in a program.
4) Offsets: Fixed differences in memory locations, which can be used to calculate addresses of functions in libc or other libraries.

 # Conclusion & RESULTS

This exploit demonstrates the power of leveraging format string vulnerabilities in combination with knowledge of memory layout and function addresses. By carefully calculating the necessary offsets and crafting a payload to manipulate the GOT, we can hijack the execution flow and achieve the ultimate goal of executing arbitrary commands on the system. The ability to calculate addresses based on leaked information from the program is a crucial skill in exploit development, especially in Capture the Flag (CTF) challenges and real-world scenarios.

EXPLOITING ------------------>

![result](https://github.com/CHIRANJEET1729DAS/PICO_CTF-Solutions-/blob/main/Binary_Exploitation/RESULTS/result_2.png)

EXECUTION ------------------->

![result](https://github.com/CHIRANJEET1729DAS/PICO_CTF-Solutions-/blob/main/Binary_Exploitation/RESULTS/Result.png)
